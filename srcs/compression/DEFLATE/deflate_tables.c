/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   deflate_tables.c                                   :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: reclaire <reclaire@student.42mulhouse.f    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2024/05/31 15:08:08 by reclaire          #+#    #+#             */
/*   Updated: 2024/06/20 15:59:01 by reclaire         ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */

#include "deflate_int.h"

// clang-format off
const struct s_ll_code ll_codes_full[] = {
	{48, 8}, {49, 8}, {50, 8}, {51, 8}, {52, 8}, {53, 8}, {54, 8}, {55, 8}, {56, 8}, {57, 8}, {58, 8}, {59, 8}, {60, 8}, {61, 8}, {62, 8}, {63, 8}, {64, 8}, {65, 8}, {66, 8}, {67, 8},
	{68, 8}, {69, 8}, {70, 8}, {71, 8}, {72, 8}, {73, 8}, {74, 8}, {75, 8}, {76, 8}, {77, 8}, {78, 8}, {79, 8}, {80, 8}, {81, 8}, {82, 8}, {83, 8}, {84, 8}, {85, 8}, {86, 8}, {87, 8},
	{88, 8}, {89, 8}, {90, 8}, {91, 8}, {92, 8}, {93, 8}, {94, 8}, {95, 8}, {96, 8}, {97, 8}, {98, 8}, {99, 8}, {100, 8}, {101, 8}, {102, 8}, {103, 8}, {104, 8}, {105, 8}, {106, 8}, {107, 8},
	{108, 8}, {109, 8}, {110, 8}, {111, 8}, {112, 8}, {113, 8}, {114, 8}, {115, 8}, {116, 8}, {117, 8}, {118, 8}, {119, 8}, {120, 8}, {121, 8}, {122, 8}, {123, 8}, {124, 8}, {125, 8}, {126, 8}, {127, 8},
	{128, 8}, {129, 8}, {130, 8}, {131, 8}, {132, 8}, {133, 8}, {134, 8}, {135, 8}, {136, 8}, {137, 8}, {138, 8}, {139, 8}, {140, 8}, {141, 8}, {142, 8}, {143, 8}, {144, 8}, {145, 8}, {146, 8}, {147, 8},
	{148, 8}, {149, 8}, {150, 8}, {151, 8}, {152, 8}, {153, 8}, {154, 8}, {155, 8}, {156, 8}, {157, 8}, {158, 8}, {159, 8}, {160, 8}, {161, 8}, {162, 8}, {163, 8}, {164, 8}, {165, 8}, {166, 8}, {167, 8},
	{168, 8}, {169, 8}, {170, 8}, {171, 8}, {172, 8}, {173, 8}, {174, 8}, {175, 8}, {176, 8}, {177, 8}, {178, 8}, {179, 8}, {180, 8}, {181, 8}, {182, 8}, {183, 8}, {184, 8}, {185, 8}, {186, 8}, {187, 8},
	{188, 8}, {189, 8}, {190, 8}, {191, 8}, {400, 9}, {401, 9}, {402, 9}, {403, 9}, {404, 9}, {405, 9}, {406, 9}, {407, 9}, {408, 9}, {409, 9}, {410, 9}, {411, 9}, {412, 9}, {413, 9}, {414, 9}, {415, 9},
	{416, 9}, {417, 9}, {418, 9}, {419, 9}, {420, 9}, {421, 9}, {422, 9}, {423, 9}, {424, 9}, {425, 9}, {426, 9}, {427, 9}, {428, 9}, {429, 9}, {430, 9}, {431, 9}, {432, 9}, {433, 9}, {434, 9}, {435, 9},
	{436, 9}, {437, 9}, {438, 9}, {439, 9}, {440, 9}, {441, 9}, {442, 9}, {443, 9}, {444, 9}, {445, 9}, {446, 9}, {447, 9}, {448, 9}, {449, 9}, {450, 9}, {451, 9}, {452, 9}, {453, 9}, {454, 9}, {455, 9},
	{456, 9}, {457, 9}, {458, 9}, {459, 9}, {460, 9}, {461, 9}, {462, 9}, {463, 9}, {464, 9}, {465, 9}, {466, 9}, {467, 9}, {468, 9}, {469, 9}, {470, 9}, {471, 9}, {472, 9}, {473, 9}, {474, 9}, {475, 9},
	{476, 9}, {477, 9}, {478, 9}, {479, 9}, {480, 9}, {481, 9}, {482, 9}, {483, 9}, {484, 9}, {485, 9}, {486, 9}, {487, 9}, {488, 9}, {489, 9}, {490, 9}, {491, 9}, {492, 9}, {493, 9}, {494, 9}, {495, 9},
	{496, 9}, {497, 9}, {498, 9}, {499, 9}, {500, 9}, {501, 9}, {502, 9}, {503, 9}, {504, 9}, {505, 9}, {506, 9}, {507, 9}, {508, 9}, {509, 9}, {510, 9}, {511, 9},
	{0, 7}, {1, 7}, {2, 7}, {3, 7}, {4, 7}, {5, 7}, {6, 7}, {7, 7}, {8, 7}, {9, 7}, {10, 7}, {11, 7}, {12, 7}, {13, 7}, {14, 7}, {15, 7}, {16, 7}, {17, 7}, {18, 7}, {19, 7}, {20, 7}, {21, 7}, {22, 7}, {23, 7},
	{192, 8}, {193, 8}, {194, 8}, {195, 8}, {196, 8}, {197, 8}, {198, 8}, {199, 8}
};


/*
Split en deux ?: <8 bits(U8) et >8 bits(U16)
voir si ca ameliore les perfs parce que du coup on aura 2 cmp pour check si le code est entre
*/
const U16 ll_codes[] = {
	// 8 bits (0 - 143)
	12, 140, 76, 204, 44, 172, 108, 236, 28, 156, 92, 220, 60, 188, 124, 252, 2, 130, 66, 194, 34,
	162, 98, 226, 18, 146, 82, 210, 50, 178, 114, 242, 10, 138, 74, 202, 42, 170, 106, 234, 26,
	154, 90, 218, 58, 186, 122, 250, 6, 134, 70, 198, 38, 166, 102, 230, 22, 150, 86, 214, 54,
	182, 118, 246, 14, 142, 78, 206, 46, 174, 110, 238, 30, 158, 94, 222, 62, 190, 126, 254, 1,
	129, 65, 193, 33, 161, 97, 225, 17, 145, 81, 209, 49, 177, 113, 241, 9, 137, 73, 201, 41,
	169, 105, 233, 25, 153, 89, 217, 57, 185, 121, 249, 5, 133, 69, 197, 37, 165, 101, 229, 21,
	149, 85, 213, 53, 181, 117, 245, 13, 141, 77, 205, 45, 173, 109, 237, 29, 157, 93, 221, 61,
	189, 125, 253,

	// 9 bits (144 - 255)
	19, 275, 147, 403, 83, 339, 211, 467, 51, 307, 179, 435, 115, 371, 243, 499, 11, 267, 139, 395, 75,
	331, 203, 459, 43, 299, 171, 427, 107, 363, 235, 491, 27, 283, 155, 411, 91, 347, 219, 475, 59,
	315, 187, 443, 123, 379, 251, 507, 7, 263, 135, 391, 71, 327, 199, 455, 39, 295, 167, 423, 103,
	359, 231, 487, 23, 279, 151, 407, 87, 343, 215, 471, 55, 311, 183, 439, 119, 375, 247, 503, 15,
	271, 143, 399, 79, 335, 207, 463, 47, 303, 175, 431, 111, 367, 239, 495, 31, 287, 159, 415, 95,
	351, 223, 479, 63, 319, 191, 447, 127, 383, 255, 511,

	// 7 bits (256 - 279)
	0, 64, 32, 96, 16, 80, 48, 112, 8, 72, 40, 104, 24, 88, 56, 120, 4, 68, 36, 100, 20, 84, 52, 116,

	// 8 bits (280 - 287)
	3, 131, 67, 195, 35, 163, 99, 227

	// + 2 codes fantomes (288, 289)
};

const U8 ll_codes_bits[] = {
	[0 ... 17] = 8,
	[18 ... 31] = 9,
	[32 ... 34] = 7,
	[35 ... 35] = 8,
};

// ll_code: index + 257
const struct s_table_entry ll_table[] = {
	{3, 3, 0x0, 0}, {4, 4, 0x0, 0}, {5, 5, 0x0, 0}, {6, 6, 0x0, 0},
	{7, 7, 0x0, 0}, {8, 8, 0x0, 0}, {9, 9, 0x0, 0}, {10, 10, 0x0, 0},
	
	{11, 12, 0x1, 1}, {13, 14, 0x1, 1}, {15, 16, 0x1, 1}, {17, 18, 0x1, 1},
	{19, 22, 0x3, 2}, {23, 26, 0x3, 2}, {27, 30, 0x3, 2}, {31, 34, 0x3, 2},
	{35, 42, 0x7, 3}, {43, 50, 0x7, 3}, {51, 58, 0x7, 3}, {59, 66, 0x7, 3},
	{67, 82, 0xF, 4}, {83, 98, 0xF, 4}, {99, 114, 0xF, 4}, {115, 130, 0xF, 4},
	{131, 162, 0x1F, 5}, {163, 194, 0x1F, 5}, {195, 226, 0x1F, 5}, {227, 257, 0x1F, 5},
	{258, 258, 0x0, 0}
};
const U8 ll_table_size = sizeof(ll_table) / sizeof(ll_table[0]);

const struct s_table_entry offset_table[] = {
	{1, 1, 0x0, 0}, {2, 2, 0x0, 0}, {3, 3, 0x0, 0}, {4, 4, 0x0, 0},
	{5, 6, 0x1, 1}, {7, 8, 0x1, 1},
	{9, 12, 0x3, 2}, {13, 16, 0x3, 2},
	{17, 24, 0x7, 3}, {25, 32, 0x7, 3},
	{33, 48, 0xF, 4}, {49, 64, 0xF, 4},
	{65, 96, 0x1F, 5}, {97, 128, 0x1F, 5},
	{129, 192, 0x3F, 6}, {193, 256, 0x3F, 6},
	{257, 384, 0x7F, 7}, {385, 512, 0x7F, 7},
	{513, 768, 0xFF, 8}, {769, 1024, 0xFF, 8},
	{1025, 1536, 0x1FF, 9}, {1537, 2048, 0x1FF, 9},
	{2049, 3072, 0x3FF, 10}, {3073, 4096, 0x3FF, 10},
	{4097, 6144, 0x7FF, 11}, {6145, 8192, 0x7FF, 11},
	{8193, 12288, 0xFFF, 12}, {12289, 16384, 0xFFF, 12},
	{16385, 24576, 0x1FFF, 13}, {24577, 32768, 0x1FFF, 13}
};
const U8 offset_table_size = sizeof(offset_table) / sizeof(offset_table[0]);
// clang-format on
